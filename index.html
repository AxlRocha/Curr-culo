import React, { useState } from 'react';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription } from '@/components/ui/alert';

const CPFForm = () => {
  const [nome, setNome] = useState('');
  const [cpf, setCpf] = useState('');
  const [isValid, setIsValid] = useState(false);
  const [showAlert, setShowAlert] = useState(false);

  const formatCPF = (value) => {
    return value
      .replace(/\D/g, '')
      .replace(/(\d{3})(\d)/, '$1.$2')
      .replace(/(\d{3})(\d)/, '$1.$2')
      .replace(/(\d{3})(\d{1,2})/, '$1-$2')
      .replace(/(-\d{2})\d+?$/, '$1');
  };

  const validateCPF = (cpf) => {
    cpf = cpf.replace(/[^\d]/g, '');
    
    if (cpf.length !== 11) return false;
    
    if (/^(\d)\1+$/.test(cpf)) return false;
    
    let sum = 0;
    for (let i = 0; i < 9; i++) {
      sum += parseInt(cpf.charAt(i)) * (10 - i);
    }
    
    let remainder = (sum * 10) % 11;
    if (remainder === 10 || remainder === 11) remainder = 0;
    if (remainder !== parseInt(cpf.charAt(9))) return false;
    
    sum = 0;
    for (let i = 0; i < 10; i++) {
      sum += parseInt(cpf.charAt(i)) * (11 - i);
    }
    
    remainder = (sum * 10) % 11;
    if (remainder === 10 || remainder === 11) remainder = 0;
    if (remainder !== parseInt(cpf.charAt(10))) return false;
    
    return true;
  };

  const handleCPFChange = (e) => {
    const formatted = formatCPF(e.target.value);
    setCpf(formatted);
    setIsValid(validateCPF(formatted));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (isValid && nome.length > 0) {
      setShowAlert(true);
      setTimeout(() => setShowAlert(false), 3000);
    }
  };

  return (
    <Card className="w-full max-w-md mx-auto">
      <CardHeader>
        <CardTitle>Cadastro de Usu√°rio</CardTitle>
      </CardHeader>
      <CardContent>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <Input
              placeholder="Nome completo"
              value={nome}
              onChange={(e) => setNome(e.target.value)}
              className="mb-4"
            />
            <Input
              placeholder="CPF"
              value={cpf}
              onChange={handleCPFChange}
              maxLength={14}
              className={`${isValid ? 'border-green-500' : 'border-red-500'}`}
            />
          </div>
          <Button 
            type="submit" 
            disabled={!isValid || nome.length === 0}
            className="w-full"
          >
            Enviar
          </Button>
        </form>
        
        {showAlert && (
          <Alert className="mt-4 bg-green-100">
            <AlertDescription>
              Dados enviados com sucesso!
            </AlertDescription>
          </Alert>
        )}
      </CardContent>
    </Card>
  );
};

export default CPFForm;
